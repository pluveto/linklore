# Linklore

Linklore 可以从 Obsidian 笔记库导出一篇笔记，并解析所有依赖的内部链接，替换为真实链接。

当你希望分享笔记时，这个程序可以帮助你将笔记中的链接转换为相对于你的 Obsidian 发布网站的真实链接，以便在其他地方使用。

## 使用方法

可以使用以下命令执行程序：

```shell
linklore -i <输入文件> [-d <目录>] [-o <输出文件>] [-p <前缀>] [-f]
```

可用的选项包括：

- `-i <输入文件>`：指定要处理的输入文件。
- `-d <目录>`：指定程序要扫描文件的目录。（默认：当前目录）
- `-o <输出文件>`：指定处理后的内容保存的输出文件。（默认：`<输入文件的基本名称> + .out.md`）
- `-p <前缀>`：设置真实链接的前缀。（默认：`/`）
- `-f`：强制覆盖输出文件，如果已经存在。

你也可以通过 `.env` 文件或环境变量来设置这些选项：

- `LINKLORE_INPUT_FILE`
- `LINKLORE_OUTPUT_FILE`
- `LINKLORE_BASE_DIR`
- `LINKLORE_PREFIX` 或 `LINKLORE_BASE_URL`
- `LINKLORE_FORCE`

## 工作原理

程序按照以下步骤处理输入文件：

1. 建立索引：
   - 程序扫描指定目录（`dir`）中的所有文件（不仅限于 `.md` 文件），并创建一个索引，记录每个文件的路径和文件名。
   - 每个文件由一个唯一的键标识，该键是文件名去除扩展名后的部分。例如，`foo/bar.md` 的键为 `bar`。
   - 索引还包含有关每个文件的其他信息，如名称、基本名称、扩展名和相对于目录（`dir`）的路径。
   - 如果文件数量超过 10,000，将报告错误，因为程序目前不支持如此多的文件。
2. 读取输入文件并解析链接：
   - 程序使用正则表达式解析输入文件中的链接。
   - 可能的链接格式包括：
     - `![[hello.png]]`：替换为真实链接 `![hello](prefix+path)`。只有这种格式允许文件扩展名。
     - `[[hello]]`：替换为真实链接 `[hello](prefix+path)`。
     - `[[hello|world]]`：处理别名后替换为真实链接 `[world](prefix+path)`。
     - `[[hello^world]]`：与格式 2 相同，替换为 `[hello](prefix+path)`。
     - `[[hello#world]]`：处理锚点后替换为真实链接 `[hello](prefix+path#world)`。
   - 如果链接在索引中找不到对应的文件，将报告错误。程序会继续处理以找到所有错误。
3. 将处理后的内容写入输出文件，而不覆盖原始文件。如果输出文件已经存在，除非指定了 `-f` 选项，否则将报告错误。

## 安装

你可以从 [发布页面](https://github.com/pluveto/linklore/releases) 下载该程序。

或者你也可以从源代码构建程序：

1. 确保你的系统已安装 Go。如果没有安装，你可以从 [官方 Go 网站](https://golang.org/dl/) 下载。
2. 确保你已安装 `make` 命令。
3. 运行以下命令构建程序：

```shell
make build
```

程序的构建产物将放置在 `./dist` 目录中。

## 许可证

本项目使用 MIT 许可证。有关更多信息，请参见 [LICENSE](./LICENSE) 文件。
